{% extends '::layout.html.twig' %}
{% if app.user.id is not defined %}
{% set guess = true %}
{% else %}
{% set guess = false %}
{% endif %}
{% block nav_secondary %}
<!-- Sidebar user -->
                    <div class="sidebar-user widget">
                        <div class="navbar"><div class="navbar-inner"><h6>{{ app.user.name }} {{ app.user.surname }}</h6></div></div>
                        <a href="#" title="" class="user" style="width: 190px; margin-left: 10px; box-shadow: 0px 0px 5px #888; margin-top: 10px; border: 1px solid #EEE; border-radius: 3px;">
                            {% if app.user.getWebPath() is not empty %}
                                <img src="{{ asset(app.user.getWebPath()) }}" style="width:100%; border-radius: 3px;">
                            {% else %}
                                <img src="{{ asset('bundles/coreresources/theme/images/avatar.png') }}" style="width:100%; border-radius: 3px;"/>
                            {% endif %}
                        </a>
                        {{ render(controller('CoreCallBundle:Call:contacts', { 'consulta': true })) }}
                    </div>
                    <!-- /sidebar user -->        
{% endblock %}
{% block section_nav %}

<ul class="round-buttons">
    <li><div class="depth"><a href="#" data-toggle="tooltip" title="Camara"><i class="icon-facetime-video"></i> Camara<strong></strong></a></div></li>
    <li><div class="depth"><a href="#" data-toggle="tooltip" title="Pizarra"><i class="icon-pencil"></i> Pizarra<strong></strong></a></div></li>
    <li><div class="depth"><a href="#" data-toggle="tooltip" title="Informes"><i class="icon-paper-clip"></i> Informes<strong></strong></a></div></li>
    <li><div class="depth"><a href="#" data-toggle="tooltip" title="Archivos"><i class="icon-folder-open"></i> Archivos<strong></strong></a></div></li>
    
</ul>

{% endblock %}
{% block header_scripts %}
    <script src="{{ asset('bundles/coreresources/js/jquery.js') }}"></script>
    <!-- open tok init -->
    <script src="http://static.opentok.com/webrtc/v2.0/js/TB.min.js"></script>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <script type="text/javascript" src="http://{{ app.request.host }}:2021/socket.io/socket.io.js"></script>
    <script type="text/javascript">

        //call vars
        var callRouteToSocket = "http://{{ app.request.host }}:2021";
        var callRouteToSocketChat = "http://{{ app.request.host }}:8052";
        var callRouteToRetrieveInfoUser = "{{  path('core_call_retrieve_info_user') }}";
        var callRouteToXmlFlashphonerConfiguration = "{{ path('core_call_resources_config_xml') }}";

        {% if guess %}
        var callMyId = 'guess_{{ professional.id }}';
        {% else %}
        var callMyId = {{ app.user.id }};
        {% endif %}


    </script>
    <script type="text/javascript">
        /*
         Definicion de los tonos de llamada
         */
        var toneCall = document.createElement('audio');
        toneCall.setAttribute('src', '{{ asset('bundles/corecall/sounds/llamando.mp3') }}');
        toneCall.setAttribute('autoplay', 'autoplay');
        toneCall.setAttribute('loop', 'loop');
        toneCall.setAttribute('preload', 'preload');
        //audioElement.load()
        $.get();
        toneCall.addEventListener("load", function() {
            toneCall.play();
        }, true);

        toneCall.pause();



        var toneRinging = document.createElement('audio');
        toneRinging.setAttribute('src', '{{ asset('bundles/corecall/sounds/sonando.wav') }}');
        toneRinging.setAttribute('autoplay', 'autoplay');
        toneRinging.setAttribute('loop', 'loop');
        //audioElement.load()
        $.get();
        toneRinging.addEventListener("load", function() {
            toneCall.play();
        }, true);

        toneRinging.pause();
    </script>
    <script type="text/javascript">

        $(document).ready(function () {

            callhandler.init();
            if (!window.webkitRTCPeerConnection && !window.webkitRTCPeerConnection){ 
                $(".videoconference.panel").css("display",'none')
                $(".browser.panel").css("display",'block')
            }

        });
    </script>
    <!-- <link href="{{ asset('bundles/corecall/css/chat.css') }}" rel="stylesheet"> -->

    <script type="text/javascript" src="{{ asset('bundles/corecall/scripts/handlerhtml5.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/corecall/scripts/sockethtml5.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/corecall/scripts/contacts.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/corecall/scripts/notifications.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/corecall/scripts/videoconferencehtml5.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/corecall/scripts/chat.js') }}"></script>


    <script type="text/javascript" src="{{ asset('bundles/coreresources/js/jquery.form.js') }}"></script>
{% endblock %}
{% block my_camera %}

    <div class="box span5" style="min-height: 300px">
        <div class="tab-header">
            CÃ¡mara remota
        <span class="pull-right">
          <span class="options">
            <a href="#"><i class="icon-facetime-video"></i></a>
          </span>
        </span>
        </div>

        <div id="videoconferenceHtml5Prototype" style="height: 300px; width: 440px; margin-left: 4px; margin-bottom: 4px" class="hide"></div>
        <div id="videoconferenceHtml5" style=" height: 300px; width: 440px;margin-left: 4px; margin-bottom: 4px"></div>
    </div>
    {% endblock %}
{% block panel %}
    <div class="browser panel" style="display:none">
        <h1>No tienes RTC</h1>
    </div>
    <div class="videoconference panel">
    <div class="row">
        <div class="span8 offset1" style="overflow: hidden;">
        {{ render(controller('CoreCallBundle:Call:notifications')) }}
        {% include "CoreCallBundle:Call:videoconferencehtml5.html.twig" %}
        </div>
    </div>

    <div class="row">
        <div class="span4 offset1">

            {% include 'CoreCallBundle:Call:contactuser.html.twig' %}

        </div>

        <div class="span4">
            {% include 'CoreCallBundle:Call:videoconferencecontrols.html.twig' %}
        </div>
    </div>
    </div>

    {% block extra_videoconference %}{% endblock %}


{% endblock %}